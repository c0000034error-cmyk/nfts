<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CryptoVerse: Secure Login</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

    <style>
        :root {
            --bg: #09090b;
            --panel: #18181b;
            --primary: #f59e0b;
            --accent: #6366f1;
            --danger: #ef4444;
            --success: #22c55e;
            --text: #e4e4e7;
            --radius: 12px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'Segoe UI', system-ui, sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            user-select: none;
        }

        /* === UI –°–¢–ò–õ–ò === */
        button { border: none; outline: none; cursor: pointer; font-family: inherit; transition: 0.2s; }
        button:active { transform: scale(0.98); }

        .header {
            padding: 15px;
            background: rgba(24, 24, 27, 0.9);
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 50;
        }
        .balance { font-size: 20px; color: var(--primary); font-weight: bold; }

        .content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            padding-bottom: 80px;
        }

        .screen { display: none; animation: fade 0.3s ease; }
        .screen.active { display: block; }
        @keyframes fade { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .card {
            background: var(--panel);
            border-radius: var(--radius);
            padding: 12px;
            border: 1px solid #27272a;
            position: relative;
        }

        .btn {
            background: var(--primary);
            color: #000;
            padding: 12px;
            border-radius: 8px;
            width: 100%;
            font-weight: 700;
            margin-top: 10px;
            font-size: 14px;
        }
        .btn-link {
            background: none;
            color: var(--accent);
            text-decoration: underline;
            padding: 5px;
            margin-top: 10px;
            font-size: 13px;
        }
        .btn-sm { padding: 5px 10px; font-size: 12px; width: auto; }
        .btn-danger { background: var(--danger); color: #fff; }

        /* –í–•–û–î / –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø */
        #auth-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg); z-index: 1000;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            padding: 30px;
        }
        .auth-box {
            width: 100%; max-width: 350px;
            background: var(--panel);
            padding: 25px;
            border-radius: 20px;
            border: 1px solid #333;
            text-align: center;
        }
        input {
            background: #27272a;
            border: 1px solid #3f3f46;
            padding: 15px;
            border-radius: 10px;
            color: #fff;
            width: 100%;
            margin-bottom: 15px;
            font-size: 16px;
            outline: none;
        }
        input:focus { border-color: var(--accent); }

        /* NFT & GAME UI */
        .nft-preview {
            width: 100%; aspect-ratio: 1; border-radius: 8px;
            margin-bottom: 8px; position: relative;
        }
        .coin-btn {
            width: 220px; height: 220px; border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #ffd700, #b8860b);
            border: 8px solid rgba(255,255,255,0.1);
            box-shadow: 0 0 50px rgba(245, 158, 11, 0.3);
            font-size: 80px; display: flex; justify-content: center; align-items: center;
            cursor: pointer; margin: 0 auto;
        }
        .coin-btn:active { transform: scale(0.95); }

        /* –ú–ï–ù–Æ */
        .navbar {
            position: fixed; bottom: 0; width: 100%;
            background: rgba(24, 24, 27, 0.95);
            display: flex; border-top: 1px solid #333;
            padding-bottom: env(safe-area-inset-bottom);
        }
        .nav-item { flex: 1; padding: 12px 0; text-align: center; font-size: 10px; color: #666; cursor: pointer; }
        .nav-item.active { color: var(--primary); }
        .nav-icon { font-size: 20px; display: block; margin-bottom: 2px; }

        .toast {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            background: #333; padding: 10px 20px; border-radius: 20px;
            z-index: 2000; display: none; border: 1px solid #555;
        }
    </style>
</head>
<body>

    <!-- –ú–û–î–ê–õ–ö–ê –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò -->
    <div id="auth-modal">
        <div class="auth-box">
            <h1 id="auth-title">–í—Ö–æ–¥</h1>
            <p style="color:#888; margin-bottom: 20px; font-size: 14px;">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ CryptoVerse</p>
            
            <input type="text" id="auth-nick" placeholder="–ù–∏–∫–Ω–µ–π–º (–õ–æ–≥–∏–Ω)" autocomplete="off">
            <input type="password" id="auth-pass" placeholder="–ü–∞—Ä–æ–ª—å (–º–∏–Ω. 6 —Å–∏–º–≤–æ–ª–æ–≤)">
            
            <button class="btn" id="auth-submit-btn" onclick="submitAuth()">–í–æ–π—Ç–∏</button>
            
            <button class="btn-link" id="auth-toggle-btn" onclick="toggleAuthMode()">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
            
            <p id="auth-error" style="color:var(--danger); font-size:13px; margin-top:15px; min-height:18px;"></p>
        </div>
    </div>

    <!-- –£–í–ï–î–û–ú–õ–ï–ù–ò–ï -->
    <div id="toast" class="toast">–°–æ–æ–±—â–µ–Ω–∏–µ</div>

    <!-- –í–ï–†–• -->
    <div class="header">
        <div style="font-size:14px; color:#aaa;">
            üë§ <span id="my-nick">...</span>
        </div>
        <div class="balance">
            <span id="balance">0</span> üí∞
        </div>
        <button class="btn-sm btn-danger" onclick="logout()" style="margin-left:10px;">–í—ã–π—Ç–∏</button>
    </div>

    <!-- –ö–û–ù–¢–ï–ù–¢ -->
    <div class="content">

        <!-- –î–û–ú -->
        <div id="tab-home" class="screen active">
            <div style="display:flex; justify-content:center; align-items:center; height:300px;">
                <div class="coin-btn" id="tap-btn">‚Çø</div>
            </div>
            <div style="text-align: center;">
                <p>‚ö° –≠–Ω–µ—Ä–≥–∏—è: <span id="energy">1000</span></p>
            </div>
            <h3>–ú–æ–∏ NFT</h3>
            <div class="grid" id="inventory-list"></div>
        </div>

        <!-- –†–´–ù–û–ö -->
        <div id="tab-market" class="screen">
            <h2>üåç –†—ã–Ω–æ–∫</h2>
            <button class="btn" style="background:var(--accent); color:white; margin-bottom:10px;" onclick="loadMarket()">–û–±–Ω–æ–≤–∏—Ç—å</button>
            <div class="grid" id="market-list"><p>–ó–∞–≥—Ä—É–∑–∫–∞...</p></div>
        </div>

        <!-- –ö–ê–ó–ò–ù–û -->
        <div id="tab-casino" class="screen">
            <h2>üé∞ –°–ª–æ—Ç—ã</h2>
            <div class="card" style="text-align:center;">
                <div style="font-size: 40px; margin: 15px 0;" id="slots-display">üçí üçã üçá</div>
                <input type="number" id="slot-bet" placeholder="–°—Ç–∞–≤–∫–∞" style="text-align:center;">
                <button class="btn" onclick="spinSlots()">–ö—Ä—É—Ç–∏—Ç—å (x5)</button>
            </div>
        </div>

    </div>

    <!-- –ú–ï–ù–Æ -->
    <div class="navbar">
        <div class="nav-item active" onclick="nav('home')"><span class="nav-icon">üè†</span>–î–æ–º</div>
        <div class="nav-item" onclick="nav('market')"><span class="nav-icon">üõí</span>–†—ã–Ω–æ–∫</div>
        <div class="nav-item" onclick="nav('casino')"><span class="nav-icon">üé∞</span>–°–ª–æ—Ç—ã</div>
    </div>

    <script>
        // === –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø FIREBASE ===
        const firebaseConfig = {
            apiKey: "AIzaSyDpX5YSiVr6ekrQRYhALaTo8C69mc1vLcg",
            authDomain: "nfts-dc174.firebaseapp.com",
            projectId: "nfts-dc174",
            storageBucket: "nfts-dc174.firebasestorage.app",
            messagingSenderId: "327365720624",
            appId: "1:327365720624:web:eb42c9d671566b5d118bf5"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // === –ü–ï–†–ï–ú–ï–ù–ù–´–ï ===
        let myUid = null;
        let myData = null;
        let isRegisterMode = false; // false = –í—Ö–æ–¥, true = –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

        // === –õ–û–ì–ò–ö–ê –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò ===
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ: –µ—Å–ª–∏ —É–∂–µ –≤–æ—à–µ–ª - –≥—Ä—É–∑–∏–º –∏–≥—Ä—É, –∏–Ω–∞—á–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É
        auth.onAuthStateChanged((user) => {
            if (user) {
                myUid = user.uid;
                document.getElementById('auth-modal').style.display = 'none';
                initGame();
            } else {
                document.getElementById('auth-modal').style.display = 'flex';
            }
        });

        function toggleAuthMode() {
            isRegisterMode = !isRegisterMode;
            const title = document.getElementById('auth-title');
            const btn = document.getElementById('auth-submit-btn');
            const toggle = document.getElementById('auth-toggle-btn');
            const error = document.getElementById('auth-error');

            error.innerText = ""; // –û—á–∏—Å—Ç–∏—Ç—å –æ—à–∏–±–∫–∏

            if (isRegisterMode) {
                title.innerText = "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è";
                btn.innerText = "–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç";
                toggle.innerText = "–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? –í–æ–π—Ç–∏";
            } else {
                title.innerText = "–í—Ö–æ–¥";
                btn.innerText = "–í–æ–π—Ç–∏";
                toggle.innerText = "–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è";
            }
        }

        async function submitAuth() {
            const nick = document.getElementById('auth-nick').value.trim();
            const pass = document.getElementById('auth-pass').value.trim();
            const errorEl = document.getElementById('auth-error');

            if (nick.length < 3) {
                errorEl.innerText = "–ù–∏–∫ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π (–º–∏–Ω 3)";
                return;
            }
            if (pass.length < 6) {
                errorEl.innerText = "–ü–∞—Ä–æ–ª—å —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π (–º–∏–Ω 6)";
                return;
            }

            // Firebase —Ç—Ä–µ–±—É–µ—Ç email, –ø–æ—ç—Ç–æ–º—É –º—ã –¥–µ–ª–∞–µ–º —Ñ–µ–π–∫–æ–≤—ã–π email –∏–∑ –Ω–∏–∫–∞
            // –£–¥–∞–ª—è–µ–º –ø—Ä–æ–±–µ–ª—ã –∏ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã –¥–ª—è email
            const safeNick = nick.replace(/[^a-zA-Z0-9]/g, "").toLowerCase();
            const fakeEmail = `${safeNick}@game.local`;

            errorEl.innerText = "–û–±—Ä–∞–±–æ—Ç–∫–∞...";

            try {
                if (isRegisterMode) {
                    // --- –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø ---
                    
                    // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–Ω—è—Ç –ª–∏ –Ω–∏–∫ –≤ –±–∞–∑–µ (–¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã)
                    const check = await db.collection('users').where('nickname', '==', nick).get();
                    if (!check.empty) {
                        throw new Error("–≠—Ç–æ—Ç –Ω–∏–∫–Ω–µ–π–º —É–∂–µ –∑–∞–Ω—è—Ç!");
                    }

                    // 2. –°–æ–∑–¥–∞–µ–º Auth User
                    const cred = await auth.createUserWithEmailAndPassword(fakeEmail, pass);
                    
                    // 3. –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å –≤ –±–∞–∑–µ
                    const newProfile = {
                        nickname: nick,
                        email: fakeEmail,
                        balance: 1000,
                        energy: 1000,
                        inventory: [generateNFT("Common")], // –ü–æ–¥–∞—Ä–æ–∫
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    
                    await db.collection('users').doc(cred.user.uid).set(newProfile);
                    // onAuthStateChanged —Å—Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∞–º –∏ –ø—É—Å—Ç–∏—Ç –≤ –∏–≥—Ä—É

                } else {
                    // --- –í–•–û–î ---
                    await auth.signInWithEmailAndPassword(fakeEmail, pass);
                    // onAuthStateChanged —Å—Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∞–º
                }

            } catch (e) {
                console.error(e);
                let msg = e.message;
                if (e.code === 'auth/email-already-in-use') msg = "–≠—Ç–æ—Ç –Ω–∏–∫ —É–∂–µ –∑–∞–Ω—è—Ç (Email –∑–∞–Ω—è—Ç).";
                if (e.code === 'auth/wrong-password') msg = "–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å.";
                if (e.code === 'auth/user-not-found') msg = "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω.";
                if (e.code === 'auth/invalid-email') msg = "–ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã –≤ –Ω–∏–∫–µ.";
                errorEl.innerText = msg;
            }
        }

        function logout() {
            auth.signOut();
            window.location.reload();
        }

        // === –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê ===
        function initGame() {
            // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∞
            db.collection('users').doc(myUid).onSnapshot(doc => {
                if(doc.exists) {
                    myData = doc.data();
                    updateUI();
                    renderInventory();
                }
            });
            loadMarket();
        }

        function updateUI() {
            if(!myData) return;
            document.getElementById('balance').innerText = myData.balance;
            document.getElementById('energy').innerText = myData.energy;
            document.getElementById('my-nick').innerText = myData.nickname;
        }

        // --- –ì–ï–ù–ï–†–ê–¢–û–† NFT ---
        function generateNFT(forcedRarity) {
            const r = Math.random();
            let rarity = forcedRarity || (r > 0.95 ? "Legendary" : r > 0.7 ? "Rare" : "Common");
            return {
                id: Date.now() + "_" + Math.floor(Math.random()*1000),
                seed: Math.floor(Math.random() * 1000000),
                rarity: rarity,
                price: calculateValue(rarity)
            };
        }
        function calculateValue(rarity) {
            if (rarity === "Legendary") return 5000;
            if (rarity === "Rare") return 1000;
            return 100;
        }
        function getPattern(seed, rarity) {
            const h1 = seed % 360; 
            const h2 = (seed * 2) % 360;
            let c = `hsl(${h1}, 70%, 50%), hsl(${h2}, 70%, 30%)`;
            if (rarity === 'Legendary') c += `, #ffd700`;
            return `linear-gradient(45deg, ${c})`;
        }

        // --- –¢–ê–ü–ê–õ–ö–ê ---
        document.getElementById('tap-btn').addEventListener('click', (e) => {
            if (myData.energy < 1) { showToast("–ù–µ—Ç —ç–Ω–µ—Ä–≥–∏–∏!"); return; }
            
            // –®–∞–Ω—Å –≤—ã–ø–∞–¥–µ–Ω–∏—è
            let drop = null;
            if(Math.random() < 0.02) drop = generateNFT();

            myData.balance++;
            myData.energy--;
            if(drop) {
                myData.inventory.push(drop);
                showToast(`–í—ã–ø–∞–ª NFT: ${drop.rarity}!`);
            }

            // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (—Ä–∞–∑ –≤ 10 –∫–ª–∏–∫–æ–≤ –∏–ª–∏ –ø—Ä–∏ –¥—Ä–æ–ø–µ)
            if(drop || myData.balance % 10 === 0) {
                db.collection('users').doc(myUid).update({
                    balance: myData.balance,
                    energy: myData.energy,
                    inventory: myData.inventory
                });
            }
            updateUI();
            
            // –ê–Ω–∏–º–∞—Ü–∏—è
            const f = document.createElement('div');
            f.innerText = drop ? "üéÅ" : "+1";
            f.style.position='absolute'; f.style.left=e.clientX+'px'; f.style.top=e.clientY+'px';
            f.style.color='white'; f.style.pointerEvents='none'; f.style.fontWeight='bold';
            document.body.appendChild(f);
            setTimeout(()=>{ f.style.transform='translateY(-50px)'; f.style.opacity=0; },50);
            setTimeout(()=>f.remove(), 500);
        });

        // –†–µ–≥–µ–Ω —ç–Ω–µ—Ä–≥–∏–∏
        setInterval(() => {
            if(myData && myData.energy < 1000) {
                myData.energy = Math.min(1000, myData.energy + 5);
                updateUI();
            }
        }, 1000);

        // --- –ò–ù–í–ï–ù–¢–ê–†–¨ ---
        function renderInventory() {
            const list = document.getElementById('inventory-list');
            list.innerHTML = '';
            myData.inventory.forEach((nft, i) => {
                const div = document.createElement('div');
                div.className = 'card';
                div.innerHTML = `
                    <div class="nft-preview" style="background:${getPattern(nft.seed, nft.rarity)}"></div>
                    <div style="font-size:12px;">${nft.rarity}<br>~${nft.price}üí∞</div>
                    <button class="btn btn-sm" onclick="sellNFT(${i})">–ü—Ä–æ–¥–∞—Ç—å</button>
                `;
                list.appendChild(div);
            });
        }

        function sellNFT(index) {
            const price = prompt("–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏:");
            if(!price || isNaN(price)) return;
            
            const nft = myData.inventory[index];
            const itemRef = db.collection('market').doc();

            // –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ø—Ä–æ–¥–∞–∂–∏
            db.runTransaction(async (t) => {
                const uRef = db.collection('users').doc(myUid);
                const uDoc = await t.get(uRef);
                const inv = uDoc.data().inventory;
                inv.splice(index, 1);
                t.update(uRef, { inventory: inv });
                t.set(itemRef, {
                    seller: myUid, sellerName: myData.nickname,
                    price: parseInt(price), nft: nft,
                    createdAt: Date.now()
                });
            }).then(() => { showToast("–í—ã—Å—Ç–∞–≤–ª–µ–Ω–æ –Ω–∞ —Ä—ã–Ω–æ–∫"); loadMarket(); });
        }

        // --- –†–´–ù–û–ö ---
        function loadMarket() {
            const list = document.getElementById('market-list');
            list.innerHTML = '–ó–∞–≥—Ä—É–∑–∫–∞...';
            db.collection('market').orderBy('createdAt', 'desc').limit(20).get().then(snap => {
                list.innerHTML = '';
                if(snap.empty) list.innerHTML = '–ü—É—Å—Ç–æ';
                snap.forEach(doc => {
                    const d = doc.data();
                    const isMe = d.seller === myUid;
                    list.innerHTML += `
                        <div class="card">
                            <div class="nft-preview" style="background:${getPattern(d.nft.seed, d.nft.rarity)}"></div>
                            <div style="font-size:12px;"><b>${d.sellerName}</b><br>${d.nft.rarity}</div>
                            <button class="btn ${isMe?'btn-danger':''}" onclick="${isMe?`cancel('${doc.id}')`:`buy('${doc.id}', ${d.price})`}">
                                ${isMe ? '–°–Ω—è—Ç—å' : `–ö—É–ø–∏—Ç—å ${d.price}`}
                            </button>
                        </div>
                    `;
                });
            });
        }

        function buy(id, price) {
            if(myData.balance < price) return showToast("–ú–∞–ª–æ –¥–µ–Ω–µ–≥");
            db.runTransaction(async (t) => {
                const mRef = db.collection('market').doc(id);
                const mDoc = await t.get(mRef);
                if(!mDoc.exists) throw "–£–∂–µ –∫—É–ø–∏–ª–∏";
                const item = mDoc.data();
                
                const buyerRef = db.collection('users').doc(myUid);
                const sellerRef = db.collection('users').doc(item.seller);

                t.update(sellerRef, { balance: firebase.firestore.FieldValue.increment(price) });
                t.update(buyerRef, { 
                    balance: firebase.firestore.FieldValue.increment(-price),
                    inventory: firebase.firestore.FieldValue.arrayUnion(item.nft)
                });
                t.delete(mRef);
            }).then(() => { showToast("–ö—É–ø–ª–µ–Ω–æ!"); loadMarket(); }).catch(e=>showToast(e));
        }
        
        function cancel(id) {
            db.collection('market').doc(id).get().then(doc => {
                const d = doc.data();
                db.collection('users').doc(myUid).update({
                    inventory: firebase.firestore.FieldValue.arrayUnion(d.nft)
                });
                doc.ref.delete();
                loadMarket();
            });
        }

        // --- –ö–ê–ó–ò–ù–û ---
        function spinSlots() {
            const betInput = document.getElementById('slot-bet');
            let bet = parseInt(betInput.value);
            if(!bet || bet < 10 || bet > myData.balance) return showToast("–°—Ç–∞–≤–∫–∞ –æ—Ç 10");
            
            myData.balance -= bet;
            updateUI();
            
            const em = ['üçí','üçã','üçá','7Ô∏è‚É£'];
            const res = [0,0,0].map(()=>em[Math.floor(Math.random()*em.length)]);
            document.getElementById('slots-display').innerText = res.join(' ');
            
            if(res[0]===res[1] && res[1]===res[2]) {
                const win = bet*5; myData.balance+=win; showToast(`–î–∂–µ–∫–ø–æ—Ç! +${win}`);
            } else if(res[0]===res[1] || res[1]===res[2] || res[0]===res[2]) {
                const win = Math.floor(bet*1.5); myData.balance+=win; showToast(`–ü–∞—Ä–∞! +${win}`);
            }
            db.collection('users').doc(myUid).update({balance: myData.balance});
        }

        // --- –ù–ê–í–ò–ì–ê–¶–ò–Ø ---
        function nav(t) {
            document.querySelectorAll('.screen').forEach(e=>e.classList.remove('active'));
            document.getElementById('tab-'+t).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(e=>e.classList.remove('active'));
            const map = {'home':0, 'market':1, 'casino':2};
            document.querySelectorAll('.nav-item')[map[t]].classList.add('active');
        }
        function showToast(m) {
            const t = document.getElementById('toast'); t.innerText=m; t.style.display='block';
            setTimeout(()=>t.style.display='none', 2000);
        }
    </script>
</body>
</html>
