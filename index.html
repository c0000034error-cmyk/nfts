<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>NFT Universe: HARDCORE</title>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <!-- Icons -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">

    <style>
        :root {
            --bg: #050505;
            --surface: #121212;
            --primary: #6366f1;
            --accent: #d946ef;
            --gold: #fbbf24;
            --danger: #ef4444;
            --success: #10b981;
            --text: #ffffff;
            --radius: 16px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            background: var(--bg); color: var(--text);
            font-family: 'Segoe UI', Roboto, sans-serif;
            margin: 0; padding: 0; height: 100vh;
            display: flex; flex-direction: column; overflow: hidden; user-select: none;
        }

        /* ANIMATIONS */
        @keyframes slotSpin { 0% { transform: translateY(0); } 100% { transform: translateY(-1000px); } }
        @keyframes shake { 0% { transform: translate(1px, 1px) rotate(0deg); } 10% { transform: translate(-1px, -2px) rotate(-1deg); } 20% { transform: translate(-3px, 0px) rotate(1deg); } 30% { transform: translate(3px, 2px) rotate(0deg); } 40% { transform: translate(1px, -1px) rotate(1deg); } 50% { transform: translate(-1px, 2px) rotate(-1deg); } 60% { transform: translate(-3px, 1px) rotate(0deg); } 70% { transform: translate(3px, 1px) rotate(-1deg); } 80% { transform: translate(-1px, -1px) rotate(1deg); } 90% { transform: translate(1px, 2px) rotate(0deg); } 100% { transform: translate(1px, -2px) rotate(-1deg); } }
        @keyframes orbit1 { from { transform: rotate(0deg) translateX(45px) rotate(0deg); } to { transform: rotate(360deg) translateX(45px) rotate(-360deg); } }
        @keyframes orbit2 { from { transform: rotate(120deg) translateX(45px) rotate(-120deg); } to { transform: rotate(480deg) translateX(45px) rotate(-480deg); } }
        @keyframes orbit3 { from { transform: rotate(240deg) translateX(45px) rotate(-240deg); } to { transform: rotate(600deg) translateX(45px) rotate(-600deg); } }
        @keyframes miniOrbit { from { transform: rotate(0deg) translateX(18px) rotate(0deg); } to { transform: rotate(360deg) translateX(18px) rotate(-360deg); } }

        /* UI */
        .btn {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: #fff; border: none; padding: 12px; border-radius: 12px;
            font-weight: 700; width: 100%; cursor: pointer;
            display: flex; justify-content: center; align-items: center; gap: 8px;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4); transition: 0.1s;
        }
        .btn:active { transform: scale(0.97); }
        .btn-outline { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); box-shadow: none; color:white; }
        .btn-danger { background: var(--danger); box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4); }
        .btn-gold { background: var(--gold); color: black; box-shadow: 0 4px 15px rgba(251, 191, 36, 0.4); }
        .btn-sm { padding: 6px 12px; font-size: 11px; width: auto; border-radius: 8px; }

        input { background: #222; border: 1px solid #333; padding: 12px; border-radius: 12px; color: white; width: 100%; outline: none; margin-bottom: 10px; font-size: 16px; }
        input:focus { border-color: var(--primary); }

        .header { padding: 10px 15px; padding-top: max(10px, env(safe-area-inset-top)); background: rgba(10, 10, 10, 0.95); backdrop-filter: blur(15px); display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.05); z-index: 50; }

        .avatar-container { position: relative; width: 50px; height: 50px; margin-right: 10px; display: flex; justify-content: center; align-items: center;}
        .avatar-frame { width: 100%; height: 100%; border-radius: 50%; background: #27272a; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 18px; border: 2px solid transparent; z-index: 2; position: relative; }
        .orbiter { position: absolute; width: 22px; height: 22px; z-index: 1; pointer-events: none; filter: drop-shadow(0 0 5px black); }
        .orb-1 { animation: orbit1 6s linear infinite; }
        .orb-2 { animation: orbit2 6s linear infinite; }
        .orb-3 { animation: orbit3 6s linear infinite; }

        /* Cosmetics */
        .frame-gold { border-color: var(--gold); box-shadow: 0 0 10px var(--gold); }
        .frame-neon { border-color: #00f2ff; box-shadow: 0 0 10px #00f2ff; }
        .frame-red { border-color: #f43f5e; box-shadow: 0 0 10px #f43f5e; }
        .nick-gold { color: var(--gold); text-shadow: 0 0 10px rgba(250, 204, 21, 0.5); }
        .nick-neon { color: #00f2ff; text-shadow: 0 0 10px rgba(6, 182, 212, 0.5); }
        .nick-red { color: #f43f5e; text-shadow: 0 0 10px rgba(244, 63, 94, 0.5); }

        .content { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 100px; }
        .screen { display: none; }
        .screen.active { display: block; }

        /* TAP AREA */
        #tap-btn { transition: transform 0.05s; position: relative; }
        #tap-btn:active { transform: scale(0.95); }
        .crit-shake { animation: shake 0.5s; }

        /* CARDS */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 10px; padding-bottom: 20px; }
        .card { border-radius: var(--radius); padding: 10px; position: relative; display: flex; flex-direction: column; align-items: center; border: 1px solid rgba(255,255,255,0.05); overflow: hidden; }
        .nft-img { width: 80px; height: 80px; object-fit: contain; margin: 10px 0; filter: drop-shadow(0 10px 15px rgba(0,0,0,0.5)); transition: 0.2s; }
        .nft-name { font-size: 12px; font-weight: 700; text-align: center; width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: white; }
        .nft-pill { font-size: 9px; padding: 2px 6px; border-radius: 4px; background: rgba(0,0,0,0.5); color: #ccc; margin-bottom: 2px; }
        .equipped-marker { position: absolute; top: 5px; right: 5px; width: 8px; height: 8px; background: var(--success); border-radius: 50%; box-shadow: 0 0 5px var(--success); }
        
        .supply-tag { position: absolute; top: 5px; left: 5px; font-size: 9px; background: rgba(255,0,0,0.5); padding: 2px 4px; border-radius: 4px; color: white; }

        /* NAV */
        .navbar { position: fixed; bottom: 0; width: 100%; background: rgba(24, 24, 27, 0.95); display: flex; justify-content: space-around; padding: 12px 0; padding-bottom: max(12px, env(safe-area-inset-bottom)); border-top: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(20px); z-index: 100; }
        .nav-item { color: #71717a; font-size: 10px; text-align: center; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 4px; transition: 0.2s; }
        .nav-item i { font-size: 22px; }
        .nav-item.active { color: var(--primary); transform: translateY(-3px); }

        /* MODALS */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 2000; display: none; align-items: center; justify-content: center; padding: 20px; backdrop-filter: blur(10px); }
        .modal-box { width: 100%; max-width: 380px; background: #18181b; padding: 24px; border-radius: 24px; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.8); border: 1px solid rgba(255,255,255,0.1); }
        .tabs { display: flex; background: #27272a; padding: 4px; border-radius: 12px; margin-bottom: 20px; overflow-x: auto; }
        .tab { flex: 1; text-align: center; padding: 8px; border-radius: 8px; font-size: 12px; color: #a1a1aa; cursor: pointer; white-space: nowrap; }
        .tab.active { background: #3f3f46; color: white; font-weight: bold; }
        .toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: rgba(220, 38, 38, 0.9); padding: 12px 24px; border-radius: 30px; z-index: 3000; display: none; border: 1px solid rgba(255,255,255,0.15); font-size: 14px; font-weight: bold; box-shadow: 0 10px 40px rgba(0,0,0,0.5); color: white; }
        .lb-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #222; margin-bottom: 5px; border-radius: 10px; }
        .mines-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; margin: 10px auto; max-width: 220px; }
        .mine { aspect-ratio: 1; background: #27272a; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; }
        .mine.boom { background: var(--danger); }
        .mine.safe { background: var(--success); color: #000; }
        .settings-row { display: flex; justify-content: space-between; align-items: center; background: #222; padding: 12px; border-radius: 12px; margin-bottom: 8px; }
        .bot-timer { font-size: 10px; color: var(--success); margin-left: 5px; font-weight: bold; display: none; }
        
        /* CHAT ORBITS */
        .chat-av-con { position: relative; width: 32px; height: 32px; }
        .chat-av { width: 100%; height: 100%; background: #333; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px; }
        .chat-orb { position: absolute; width: 12px; height: 12px; top: 0; left: 0; animation: miniOrbit 4s linear infinite; }

        /* SLOT MACHINE */
        .slot-window { height: 80px; overflow: hidden; background: #000; border-radius: 10px; margin: 10px 0; display: flex; justify-content: center; align-items: center; font-size: 40px; border: 1px solid #333; }
        .slot-col { width: 60px; text-align: center; }
        .spinning { animation: slotSpin 0.5s linear infinite; }
    </style>
</head>
<body>

    <!-- AUTH -->
    <div id="auth-modal" class="modal-overlay" style="display:flex; z-index:9000; background:#000;">
        <div class="modal-box" style="border:none; background:transparent;">
            <h1 style="margin-bottom: 30px; font-weight:900; letter-spacing: 1px; color: var(--danger);">HARDCORE NFT</h1>
            <div style="background: #18181b; padding: 24px; border-radius: 24px; border:1px solid #333;">
                <h3 id="auth-title" style="margin-top:0; color:white;">–í—Ö–æ–¥</h3>
                <input type="text" id="auth-nick" placeholder="–ù–∏–∫–Ω–µ–π–º">
                <input type="password" id="auth-pass" placeholder="–ü–∞—Ä–æ–ª—å">
                <button class="btn" onclick="submitAuth()">–í–æ–π—Ç–∏</button>
                <div onclick="toggleAuth()" style="margin-top:20px; font-size:13px; color: #a1a1aa; cursor:pointer;">
                    –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <span style="text-decoration: underline; color:var(--primary);">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</span>
                </div>
                <div id="auth-error" style="color:var(--danger); font-size:12px; margin-top:10px;"></div>
            </div>
        </div>
    </div>

    <!-- BAN SCREEN -->
    <div id="ban-screen" class="modal-overlay" style="z-index:9999; background:black;">
        <div style="text-align:center; color:red;">
            <h1>üö´ BANNED</h1>
            <p>–û–±–Ω–∞—Ä—É–∂–µ–Ω –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä. –ê–∫–∫–∞—É–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω.</p>
            <p>–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É kayivi.</p>
        </div>
    </div>

    <!-- HEADER -->
    <div class="header">
        <div style="display:flex; gap:10px; align-items:center;">
            <div class="avatar-container">
                <div id="my-frame" class="avatar-frame">U</div>
                <img src="" class="orbiter orb-1" id="orb-1" style="display:none;">
                <img src="" class="orbiter orb-2" id="orb-2" style="display:none;">
                <img src="" class="orbiter orb-3" id="orb-3" style="display:none;">
            </div>
            <div>
                <div id="my-nick" style="font-weight:700; font-size:14px; color:white;">User</div>
                <div style="font-size:12px; color:var(--text-sec); display:flex; gap:5px;">
                    <span id="balance" style="color:var(--gold); font-weight:bold;">0</span> üíé <span id="bot-timer" class="bot-timer"></span>
                </div>
            </div>
        </div>
        <div style="display:flex; gap:8px;">
            <button class="btn-sm btn-outline" onclick="openModal('boost-modal')">‚ö° <span id="energy">0</span></button>
            <button id="admin-btn" class="btn-sm btn-danger" style="display:none;" onclick="openModal('admin-modal')">ADM</button>
        </div>
    </div>

    <!-- CONTENT -->
    <div class="content">

        <!-- 1. HOME -->
        <div id="screen-home" class="screen active">
            <div style="display:flex; justify-content:center; padding:30px 0;">
                <div id="tap-btn" style="width:240px; height:240px; border-radius:50%; background:radial-gradient(circle at 30%, #333, #000); box-shadow:0 0 60px rgba(255, 255, 255, 0.1); display:flex; justify-content:center; align-items:center; cursor:pointer; position:relative; border:2px solid rgba(255,255,255,0.1);">
                    <img src="https://cdn.jsdelivr.net/gh/Tarikul-Islam-Anik/Animated-Fluent-Emojis@master/Emojis/Objects/Money%20Bag.png" width="150" style="pointer-events: none;">
                </div>
            </div>
            <h3 style="margin-bottom: 15px; color:white;">–ö–æ–ª–ª–µ–∫—Ü–∏—è (<span id="inv-count">0</span>)</h3>
            <div class="grid" id="inventory-list"></div>
        </div>

        <!-- 2. MARKET -->
        <div id="screen-market" class="screen">
            <div class="tabs">
                <div class="tab active" onclick="switchMarket('shop', this)">–ú–∞–≥–∞–∑–∏–Ω</div>
                <div class="tab" onclick="switchMarket('p2p', this)">–ë–∏—Ä–∂–∞</div>
            </div>
            <div id="view-shop">
                <div class="grid" id="shop-list"></div>
            </div>
            <div id="view-p2p" style="display:none;">
                <button class="btn btn-outline" onclick="loadP2P()" style="margin-bottom:15px; width:100%;">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
                <div class="grid" id="p2p-list"></div>
            </div>
        </div>

        <!-- 3. TOP -->
        <div id="screen-top" class="screen">
            <div class="tabs">
                <div class="tab active" onclick="loadTop('balance', this)">–ë–æ–≥–∞—á–∏</div>
                <div class="tab" onclick="loadTop('count', this)">–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä—ã</div>
            </div>
            <div id="top-list"></div>
        </div>

        <!-- 4. SOCIAL -->
        <div id="screen-social" class="screen">
            <div style="background:#27272a; padding:15px; border-radius:16px; margin-bottom:20px; display:flex; gap:10px;">
                <input type="text" id="search-nick" placeholder="–ù–∏–∫ –¥—Ä—É–≥–∞..." style="margin:0;">
                <button class="btn-sm btn-outline" onclick="addFriend()">+</button>
            </div>
            <h3 style="color:white; margin-bottom:15px;">–î—Ä—É–∑—å—è</h3>
            <div id="friends-list"></div>
        </div>

        <!-- 5. CASINO -->
        <div id="screen-casino" class="screen">
            <div class="tabs">
                <div class="tab active" onclick="switchGame('mines', this)">–ú–∏–Ω—ã</div>
                <div class="tab" onclick="switchGame('coin', this)">–ú–æ–Ω–µ—Ç–∫–∞</div>
                <div class="tab" onclick="switchGame('slots', this)">–°–ª–æ—Ç—ã</div>
            </div>

            <!-- Mines -->
            <div id="game-mines" style="text-align:center;">
                <div class="mines-grid" id="mines-field" style="max-width:250px; margin:0 auto 15px auto;"></div>
                <input type="number" id="mines-bet" placeholder="–°—Ç–∞–≤–∫–∞">
                <button class="btn btn-success" id="mines-btn" onclick="startMines()" style="margin-top:10px;">–ò–≥—Ä–∞—Ç—å</button>
            </div>

            <!-- Coin Flip -->
            <div id="game-coin" style="display:none; text-align:center;">
                <div style="font-size:60px; margin:30px;">ü™ô</div>
                <input type="number" id="coin-bet" placeholder="–°—Ç–∞–≤–∫–∞" style="margin-bottom:20px;">
                <div style="display:flex; justify-content:center; gap:10px;">
                    <button class="btn-sm btn-outline" onclick="playCoin('h')">–û—Ä–µ–ª</button>
                    <button class="btn-sm btn-outline" onclick="playCoin('t')">–†–µ—à–∫–∞</button>
                </div>
            </div>

            <!-- Slots -->
            <div id="game-slots" style="display:none; text-align:center; padding:30px; background:#18181b; border-radius:16px;">
                <div class="slot-window">
                    <div id="slot1" class="slot-col">üçí</div>
                    <div id="slot2" class="slot-col">üçí</div>
                    <div id="slot3" class="slot-col">üçí</div>
                </div>
                <input type="number" id="slots-bet" placeholder="–°—Ç–∞–≤–∫–∞">
                <button class="btn" onclick="playSlots()" style="margin-top:10px;">–ö–†–£–¢–ò–¢–¨</button>
            </div>
        </div>

        <!-- 6. PROFILE -->
        <div id="screen-profile" class="screen">
            <h2 style="color:white; margin-bottom:20px;">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
            <div class="settings-row">
                <span>–¶–≤–µ—Ç –Ω–∏–∫–∞ (–ê–∫—Ç–∏–≤–∞—Ü–∏—è)</span>
                <select id="nick-select" onchange="setStyle('nick')" style="width:120px; padding:5px;">
                    <option value="none">–°—Ç–∞–Ω–¥–∞—Ä—Ç</option>
                </select>
            </div>
            <div class="settings-row">
                <span>–†–∞–º–∫–∞ (–ê–∫—Ç–∏–≤–∞—Ü–∏—è)</span>
                <select id="frame-select" onchange="setStyle('frame')" style="width:120px; padding:5px;">
                    <option value="none">–°—Ç–∞–Ω–¥–∞—Ä—Ç</option>
                </select>
            </div>
            
            <div style="background:#18181b; padding:15px; border-radius:16px; margin-bottom:15px;">
                <h4 style="margin:0 0 10px 0;">–ú–∞–≥–∞–∑–∏–Ω –°—Ç–∏–ª—è</h4>
                <div style="display:flex; gap:10px; flex-wrap:wrap;">
                    <button class="btn-sm btn-outline" style="color:gold" onclick="buyCosmetic('nick_gold', 250000)">Gold Nick (250k)</button>
                    <button class="btn-sm btn-outline" style="color:#00f2ff" onclick="buyCosmetic('nick_neon', 150000)">Neon Nick (150k)</button>
                    <button class="btn-sm btn-outline" style="color:red" onclick="buyCosmetic('nick_red', 100000)">Red Nick (100k)</button>
                </div>
                <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;">
                    <button class="btn-sm btn-outline" style="border-color:gold" onclick="buyCosmetic('frame_gold', 500000)">Gold Frame (500k)</button>
                    <button class="btn-sm btn-outline" style="border-color:#00f2ff" onclick="buyCosmetic('frame_neon', 300000)">Neon Frame (300k)</button>
                </div>
            </div>
            
            <button class="btn btn-outline" onclick="logout()" style="margin-top:20px;">–í—ã–π—Ç–∏</button>
        </div>

    </div>

    <!-- MODALS -->
    <div id="nft-modal" class="modal-overlay">
        <div class="modal-box">
            <h2 id="modal-name" style="color:white; margin:0;">Item</h2>
            <p id="modal-serial" style="color:#888; font-size:12px; margin-bottom:10px;">#000</p>
            <div id="modal-bg-container" style="border-radius:20px; padding:20px; margin-bottom:20px; transition:0.3s;">
                <img src="" id="modal-img" style="width:140px; height:140px; object-fit:contain; filter:drop-shadow(0 0 10px rgba(0,0,0,0.5));">
            </div>
            <div class="tabs">
                <div class="tab active" onclick="setNftTab('equip')">–î–µ–π—Å—Ç–≤–∏—è</div>
                <div class="tab" onclick="setNftTab('sell')">–ü—Ä–æ–¥–∞—Ç—å</div>
            </div>
            <div id="tab-equip">
                <button class="btn" onclick="equipNft()">üéí –ù–∞–¥–µ—Ç—å / –°–Ω—è—Ç—å</button>
                <button class="btn btn-outline" style="margin-top:10px;" onclick="setNftTab('gift')">üéÅ –ü–æ–¥–∞—Ä–∏—Ç—å</button>
            </div>
            <div id="tab-sell" style="display:none;">
                <button class="btn btn-outline" style="color:var(--danger); border-color:var(--danger); margin-bottom:15px;" onclick="sellSystem()">üî• –°–∂–µ—á—å (+<span id="sys-price">0</span>)</button>
                <input type="number" id="p2p-price" placeholder="–¶–µ–Ω–∞ –¥–ª—è –±–∏—Ä–∂–∏">
                <button class="btn" onclick="sellP2P()" style="margin-top:10px;">–í—ã—Å—Ç–∞–≤–∏—Ç—å</button>
            </div>
            <div id="tab-gift" style="display:none;">
                <input type="text" id="gift-nick" placeholder="–ù–∏–∫ –¥—Ä—É–≥–∞">
                <button class="btn" onclick="sendGift()" style="margin-top:10px;">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </div>
            <button class="btn-sm" onclick="closeModal('nft-modal')" style="margin-top:20px; background:transparent; color:#888;">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <div id="boost-modal" class="modal-overlay">
        <div class="modal-box">
            <h3>–ü—Ä–æ–∫–∞—á–∫–∞ (HARD)</h3>
            <div class="settings-row">
                <div><b>–ú—É–ª—å—Ç–∏-—Ç–∞–ø</b><br><span style="font-size:11px;color:#888;">–£—Ä. <span id="tap-lvl">1</span></span></div>
                <button class="btn-sm btn-outline" onclick="buyTap()">+1 (<span id="tap-cost">100</span>)</button>
            </div>
             <div class="settings-row">
                <div><b>–†–µ–≥–µ–Ω</b><br><span style="font-size:11px;color:#888;">–£—Ä. <span id="regen-lvl">1</span></span></div>
                <button class="btn-sm btn-outline" onclick="buyRegen()">+1 (<span id="regen-cost">300</span>)</button>
            </div>
            <div class="settings-row">
                <div><b>–ê–≤—Ç–æ-–ë–æ—Ç</b><br><span style="font-size:11px;color:#888;">30 –º–∏–Ω</span></div>
                <button class="btn-sm btn-gold" onclick="buyBot()">–ö—É–ø–∏—Ç—å (25000)</button>
            </div>
            <button class="btn-sm btn-outline" onclick="closeModal('boost-modal')" style="width:100%; margin-top:10px;">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <div id="chat-modal" class="modal-overlay">
        <div class="modal-box" style="height:80vh; display:flex; flex-direction:column;">
            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                <b id="chat-title" style="color:white;">–ß–∞—Ç</b> <span onclick="closeModal('chat-modal')" style="cursor:pointer;">‚úï</span>
            </div>
            <div id="chat-history" style="flex:1; background:#111; border-radius:12px; overflow-y:scroll; padding:10px; display:flex; flex-direction:column; gap:10px;"></div>
            <div style="display:flex; gap:5px; margin-top:10px;">
                <input type="text" id="chat-msg" style="margin:0;"> <button class="btn-sm" onclick="sendMsg()">></button>
            </div>
        </div>
    </div>

    <div id="admin-modal" class="modal-overlay">
        <div class="modal-box" style="border-color: var(--danger);">
            <h2 style="color:var(--danger)">GOD MODE</h2>
            <input type="text" id="adm-target" placeholder="–ù–∏–∫">
            <input type="number" id="adm-amount" placeholder="–°—É–º–º–∞">
            <div style="display:flex; gap:5px; justify-content:center; margin-top:10px;">
                <button class="btn-sm btn-danger" onclick="adminAction('bal')">–ë–∞–ª–∞–Ω—Å</button>
                <button class="btn-sm btn-outline" onclick="adminAction('ban')">–ë–∞–Ω</button>
                <button class="btn-sm btn-outline" onclick="adminAction('unban')">–†–∞–∑–±–∞–Ω</button>
            </div>
            <button class="btn-sm btn-gold" onclick="adminGiveNFT()" style="margin-top:10px;">–í—ã–¥–∞—Ç—å NFT</button>
            <button class="btn-outline btn-sm" style="margin-top:10px; width:100%;" onclick="closeModal('admin-modal')">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>
    
    <div id="confirm-modal" class="modal-overlay">
        <div class="modal-box">
            <h3>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h3>
            <p id="conf-txt" style="color:#ccc; margin:15px 0;">–ö—É–ø–∏—Ç—å?</p>
            <div style="display:flex; gap:10px;">
                <button class="btn btn-success" onclick="confirmYes()">–î–∞</button>
                <button class="btn btn-outline" onclick="closeModal('confirm-modal')">–ù–µ—Ç</button>
            </div>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <!-- NAV -->
    <div class="navbar">
        <div class="nav-item active" onclick="nav('home', this)"><i class="ri-home-5-line"></i><span>–î–æ–º</span></div>
        <div class="nav-item" onclick="nav('market', this)"><i class="ri-store-2-line"></i><span>–®–æ–ø</span></div>
        <div class="nav-item" onclick="nav('top', this)"><i class="ri-trophy-line"></i><span>–¢–æ–ø</span></div>
        <div class="nav-item" onclick="nav('social', this)"><i class="ri-group-line"></i><span>–õ—é–¥–∏</span></div>
        <div class="nav-item" onclick="nav('casino', this)"><i class="ri-gamepad-line"></i><span>–ò–≥—Ä—ã</span></div>
        <div class="nav-item" onclick="nav('profile', this)"><i class="ri-user-settings-line"></i><span>–Ø</span></div>
    </div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyDpX5YSiVr6ekrQRYhALaTo8C69mc1vLcg", authDomain: "nfts-dc174.firebaseapp.com", projectId: "nfts-dc174", storageBucket: "nfts-dc174.firebasestorage.app", messagingSenderId: "327365720624", appId: "1:327365720624:web:eb42c9d671566b5d118bf5" };
        firebase.initializeApp(firebaseConfig); const db = firebase.firestore();

        const BASE = "https://cdn.jsdelivr.net/gh/Tarikul-Islam-Anik/Animated-Fluent-Emojis@master/Emojis";
        const make = (n,t,u,p,s) => ({n,t,u,p,s:s||1000}); // s = supply limit
        
        // HARDCORE PRICES (x50)
        const ASSETS = [
            make("–†–∞–∫–µ—Ç–∞","–¢–µ—Ö–Ω–æ","/Travel%20and%20places/Rocket.png",100000, 500),
            make("–ö–æ—Ä–æ–Ω–∞","–†–æ—Å–∫–æ—à—å","/Objects/Crown.png",2500000, 10),
            make("–ê–ª–º–∞–∑","–†–æ—Å–∫–æ—à—å","/Objects/Gem%20Stone.png",500000, 50),
            make("–†–æ–±–æ—Ç","–¢–µ—Ö–Ω–æ","/People/Robot.png",250000, 200),
            make("–ö–æ—Ç","–ü–∏—Ç–æ–º–µ—Ü","/Animals/Cat%20Face.png",150000, 800),
            make("–ë—É—Ä–≥–µ—Ä","–ï–¥–∞","/Food/Hamburger.png",50000, 2000),
            make("–î–µ–Ω—å–≥–∏","–†–æ—Å–∫–æ—à—å","/Objects/Money%20Bag.png",500000, 100),
            make("–ß–µ—Ä–µ–ø","–†–µ–¥–∫–æ–µ","/Body/Skull.png",200000, 300),
            // ... (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ, –Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∞ —Ö–≤–∞—Ç–∏—Ç –æ—Å–Ω–æ–≤–Ω—ã—Ö)
        ];

        let myNick=localStorage.getItem('nft_nick'), data, selIdx, chatUnsub, curChat, isReg=false;
        let mines={a:false,m:[],s:0,b:0}, pendingAction=null;
        let clicks=0, lastClick=0, warn=0; // Anticheat

        if(myNick) checkSession(); else document.getElementById('auth-modal').style.display='flex';

        function toggleAuth(){ isReg=!isReg; document.getElementById('auth-title').innerText=isReg?"–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è":"–í—Ö–æ–¥"; }
        async function submitAuth() {
            const n=document.getElementById('auth-nick').value.trim();
            const p=document.getElementById('auth-pass').value.trim();
            if(n.length<3||p.length<4) return alert("–ö–æ—Ä–æ—Ç–∫–æ");
            try {
                const doc=await db.collection('users').doc(n).get();
                if(isReg) {
                    if(doc.exists) throw "–ó–∞–Ω—è—Ç";
                    await db.collection('users').doc(n).set({password:p,nickname:n,balance:0,energy:1000,inventory:[],friends:[],upgrades:{},equipped:[],activeStyle:{nick:'',frame:''},tapLvl:1,regenLvl:1,botExp:0,isBanned:false,createdAt:Date.now()});
                    loginSuccess(n);
                } else {
                    if(!doc.exists||doc.data().password!==p) throw "–û—à–∏–±–∫–∞";
                    loginSuccess(n);
                }
            } catch(e){ document.getElementById('auth-error').innerText=e.toString(); }
        }
        function loginSuccess(n){ localStorage.setItem('nft_nick',n); myNick=n; document.getElementById('auth-modal').style.display='none'; checkSession(); }
        function logout(){ localStorage.removeItem('nft_nick'); location.reload(); }

        function checkSession() {
            db.collection('users').doc(myNick).onSnapshot(d=>{
                if(d.exists){ 
                    data=d.data();
                    if(data.isBanned) { document.getElementById('ban-screen').style.display='flex'; return; }
                    // Migration
                    if(!data.activeStyle) data.activeStyle = {nick:'', frame:''};
                    
                    // Listen to messages/buys for toast
                    if(data.lastMsg && data.lastMsg > Date.now()-2000) toast("–ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ!");

                    updateUI(); renderInv(); renderShop(); loadP2P(); renderFriends(); updateSettings();
                    if(myNick==='kayivi') document.getElementById('admin-btn').style.display='block';
                } else logout();
            });
            setInterval(()=>{
                if(data){
                    // HARDCORE REGEN (Slower)
                    if(data.energy<1000) data.energy += (data.regenLvl * 0.5);
                    if(data.botExp>Date.now()) data.balance+=data.tapLvl;
                    updateUI();
                    
                    // Anti-Cheat reset
                    clicks = 0;
                }
            },1000);
        }

        function updateUI() {
            document.getElementById('balance').innerText = Math.floor(data.balance).toLocaleString();
            document.getElementById('energy').innerText = Math.floor(data.energy);
            document.getElementById('inv-count').innerText = data.inventory.length;
            
            const nickEl = document.getElementById('my-nick'); nickEl.innerText = myNick;
            nickEl.className = data.activeStyle.nick || '';
            
            const fe=document.getElementById('my-frame'); fe.innerText=myNick[0].toUpperCase();
            fe.className = 'avatar-frame ' + (data.activeStyle.frame || '');
            
            ['orb-1','orb-2','orb-3'].forEach(id=>document.getElementById(id).style.display='none');
            data.equipped.forEach((item, i) => {
                if(i<3) {
                    const el = document.getElementById(`orb-${i+1}`);
                    el.src = BASE + item.u;
                    el.style.display = 'block';
                }
            });

            document.getElementById('tap-lvl').innerText=data.tapLvl;
            document.getElementById('tap-cost').innerText=Math.floor(100*Math.pow(2, data.tapLvl-1)); // Harder cost
            document.getElementById('regen-lvl').innerText=data.regenLvl;
            document.getElementById('regen-cost').innerText=Math.floor(100*Math.pow(2, data.regenLvl-1));

            if(data.botExp>Date.now()) {
                const diff=Math.floor((data.botExp-Date.now())/1000);
                document.getElementById('bot-timer').innerText = `ü§ñ ${Math.floor(diff/60)}:${diff%60}`;
                document.getElementById('bot-timer').style.display='inline';
            } else document.getElementById('bot-timer').style.display='none';
        }

        // --- ANTICHEAT TAP ---
        document.getElementById('tap-btn').addEventListener('click', e=>{
            if(data.isBanned) return;
            
            const now = Date.now();
            clicks++;
            
            // Check speed (Human limit ~10-12 cps)
            if(clicks > 15) {
                warn++;
                toast(`Warning ${warn}/3: Slow down!`);
                if(warn >= 3) {
                    db.collection('users').doc(myNick).update({isBanned:true});
                    return;
                }
            }

            if(data.energy<1) return toast("–ù–µ—Ç —ç–Ω–µ—Ä–≥–∏–∏");
            const gain = data.tapLvl; 
            data.balance+=gain; data.energy--;
            if(data.balance%20===0) save(); updateUI();
            
            const el=document.createElement('div'); el.innerText="+"+gain; 
            el.style.position='absolute'; el.style.left=e.clientX+'px'; el.style.top=e.clientY+'px'; el.style.color='#fff'; 
            el.style.pointerEvents='none'; document.body.appendChild(el); setTimeout(()=>el.remove(),500);
        });

        // --- SHOP with CONFIRM ---
        function renderShop(){
            const l=document.getElementById('shop-list'); if(l.children.length>0)return;
            ASSETS.forEach(a=>{
                const d=document.createElement('div'); d.className='card'; d.style.background='#18181b';
                d.innerHTML=`<div class="supply-tag">${a.s} left</div><img src="${BASE+a.u}" class="nft-img"><div class="nft-name">${a.n}</div><button class="btn btn-sm btn-outline" style="margin-top:5px;" onclick="askBuyShop('${a.n}', ${a.p})">${a.p.toLocaleString()} üíé</button>`;
                l.appendChild(d);
            });
        }
        function askBuyShop(n, p) { pendingAction = {t:'shop', n:n, p:p}; document.getElementById('conf-txt').innerText=`–ö—É–ø–∏—Ç—å ${n} –∑–∞ ${p}?`; openModal('confirm-modal'); }
        
        function confirmYes() {
            closeModal('confirm-modal');
            if(!pendingAction) return;
            if(pendingAction.t === 'shop') buyShop(pendingAction.n, pendingAction.p);
        }

        function buyShop(name, price){
            if(data.balance<price)return toast("–ú–∞–ª–æ –¥–µ–Ω–µ–≥");
            data.balance-=price;
            const item = ASSETS.find(x=>x.n===name);
            // Inflate price by 1% for everyone logic (simulated here locally for simplicity)
            data.inventory.push({
                id:Date.now(), name:item.n, type:item.t, u:item.u, p:price, 
                serial:Math.floor(Math.random()*item.s)+1
            });
            save(); toast("–ö—É–ø–ª–µ–Ω–æ!");
        }

        // --- INV & EQUIP ---
        function renderInv() {
            const l=document.getElementById('inventory-list'); l.innerHTML='';
            data.inventory.forEach((n,i)=>{
                const isEq = data.equipped.find(e=>e.id===n.id);
                const d=document.createElement('div'); d.className='card'; d.style.background='#222';
                d.innerHTML=`${isEq?'<span class="equipped-marker"></span>':''}<img src="${BASE+n.u}" class="nft-img"><div class="nft-name">${n.name}</div><div style="font-size:10px;color:#aaa;">#${n.serial}</div><button class="btn btn-sm btn-outline" style="width:100%;margin-top:5px;background:rgba(0,0,0,0.5)" onclick="openNft(${i})">–ú–µ–Ω—é</button>`;
                l.appendChild(d);
            });
        }
        function openNft(i) {
            selIdx=i; const n=data.inventory[i];
            document.getElementById('modal-name').innerText=n.name;
            document.getElementById('modal-serial').innerText=`#${n.serial}`;
            document.getElementById('modal-img').src=BASE+n.u;
            document.getElementById('sys-price').innerText=Math.floor((n.p||1000)*0.5);
            openModal('nft-modal'); setNftTab('equip');
        }
        function equipNft() {
            const n=data.inventory[selIdx];
            const idx = data.equipped.findIndex(e=>e.id===n.id);
            if(idx > -1) { data.equipped.splice(idx,1); toast("–°–Ω—è—Ç–æ"); } 
            else { if(data.equipped.length>=3) return toast("–ú–∞–∫—Å–∏–º—É–º 3!"); data.equipped.push(n); toast("–ù–∞–¥–µ—Ç–æ"); }
            save(); closeModal('nft-modal');
        }

        // --- STYLES ---
        function updateSettings() {
            // Fill select with owned upgrades
            const ns = document.getElementById('nick-select');
            const fs = document.getElementById('frame-select');
            ns.innerHTML='<option value="">–°—Ç–∞–Ω–¥–∞—Ä—Ç</option>'; fs.innerHTML='<option value="">–°—Ç–∞–Ω–¥–∞—Ä—Ç</option>';
            
            if(data.upgrades.nick_gold) ns.innerHTML+='<option value="nick-gold">Gold</option>';
            if(data.upgrades.nick_neon) ns.innerHTML+='<option value="nick-neon">Neon</option>';
            if(data.upgrades.nick_red) ns.innerHTML+='<option value="nick-red">Red</option>';
            
            if(data.upgrades.frame_gold) fs.innerHTML+='<option value="frame-gold">Gold</option>';
            if(data.upgrades.frame_neon) fs.innerHTML+='<option value="frame-neon">Neon</option>';
            if(data.upgrades.frame_red) fs.innerHTML+='<option value="frame-red">Red</option>';
            
            ns.value = data.activeStyle.nick;
            fs.value = data.activeStyle.frame;
        }
        function setStyle(t) {
            if(t==='nick') data.activeStyle.nick = document.getElementById('nick-select').value;
            if(t==='frame') data.activeStyle.frame = document.getElementById('frame-select').value;
            save();
        }

        // --- CASINO (HARDCORE) ---
        function startMines(){
            if(mines.a)return; 
            const b=parseInt(document.getElementById('mines-bet').value);
            if(!b||b>data.balance)return toast("–°—Ç–∞–≤–∫–∞?");
            data.balance-=b; mines={a:true,m:[],s:0,b:b};
            while(mines.m.length<5){const r=Math.floor(Math.random()*16);if(!mines.m.includes(r))mines.m.push(r);} // 5 Mines (Harder)
            const g=document.getElementById('mines-field'); g.innerHTML='';
            for(let i=0;i<16;i++){
                const c=document.createElement('div'); c.className='mine';
                c.onclick=()=>{
                    if(!mines.a||c.innerHTML!=='')return;
                    if(mines.m.includes(i)){
                        c.innerHTML='üí£'; c.classList.add('boom'); mines.a=false; toast("LOSE");
                        document.getElementById('mines-btn').innerText="–ò–≥—Ä–∞—Ç—å"; document.getElementById('mines-btn').onclick=startMines;
                    } else {
                        c.innerHTML='üíé'; c.classList.add('safe'); mines.s++;
                        document.getElementById('mines-btn').innerText=`–ó–∞–±—Ä–∞—Ç—å (${Math.floor(mines.b*(1+mines.s*0.2))})`; // Lower multiplier
                        document.getElementById('mines-btn').onclick=()=>{
                            const w=Math.floor(mines.b*(1+mines.s*0.2)); data.balance+=w; save(); toast("WIN "+w); mines.a=false; 
                            document.getElementById('mines-btn').innerText="–ò–≥—Ä–∞—Ç—å"; document.getElementById('mines-btn').onclick=startMines;
                        };
                    }
                };
                g.appendChild(c);
            }
            save();
        }

        function playCoin(p) {
            const b=parseInt(document.getElementById('coin-bet').value);
            if(!b||b>data.balance)return toast("–°—Ç–∞–≤–∫–∞?");
            data.balance-=b;
            const r = Math.random()<0.5 ? 'h' : 't';
            if(r===p) {
                const w = Math.floor(b * 1.9); // 10% house edge
                data.balance+=w; toast("WIN!");
            } else toast("LOSE");
            save();
        }

        function playSlots(){
            const b=parseInt(document.getElementById('slots-bet').value); if(!b||b>data.balance)return toast("–°—Ç–∞–≤–∫–∞?");
            data.balance-=b;
            const slots = [document.getElementById('slot1'), document.getElementById('slot2'), document.getElementById('slot3')];
            slots.forEach(s => s.classList.add('spinning'));
            
            setTimeout(() => {
                const r = [ri(), ri(), ri()];
                slots.forEach((s, i) => { s.innerText = r[i]; s.classList.remove('spinning'); });
                
                if(r[0]==r[1]&&r[1]==r[2]){data.balance+=b*10;toast("JACKPOT x10!");}
                else if(r[0]==r[1]||r[1]==r[2]||r[0]==r[2]){data.balance+=Math.floor(b*2);toast("WIN x2!");}
                else toast("Lose");
                save();
            }, 2000);
        }
        function ri(){return ['üçí','üíé','7Ô∏è‚É£','üí©'][Math.floor(Math.random()*4)]} // 4 symbols = harder

        // --- ADMIN ---
        function adminAction(act){
            const t=document.getElementById('adm-target').value.trim();
            const a=parseInt(document.getElementById('adm-amount').value);
            if(act==='bal') db.collection('users').doc(t).update({balance:firebase.firestore.FieldValue.increment(a)});
            if(act==='ban') db.collection('users').doc(t).update({isBanned:true});
            if(act==='unban') db.collection('users').doc(t).update({isBanned:false});
            toast("Done");
        }
        function adminGiveNFT() {
             const t=document.getElementById('adm-target').value.trim();
             const item = ASSETS[Math.floor(Math.random()*ASSETS.length)];
             db.collection('users').doc(t).update({
                 inventory: firebase.firestore.FieldValue.arrayUnion({
                     id:Date.now(), name:item.n, type:item.t, u:item.u, p:item.p, serial:1
                 })
             });
             toast("Given");
        }

        // --- UTILS ---
        function save(){ db.collection('users').doc(myNick).update({balance:data.balance, energy:data.energy, inventory:data.inventory, upgrades:data.upgrades, equipped:data.equipped, activeStyle:data.activeStyle, tapLvl:data.tapLvl, regenLvl:data.regenLvl, botExp:data.botExp}); }
        function buyTap(){const c=Math.floor(100*Math.pow(2,data.tapLvl-1));if(data.balance<c)return toast("–ú–∞–ª–æ –¥–µ–Ω–µ–≥");data.balance-=c;data.tapLvl++;save();toast("LVL UP!");}
        function buyBot(){if(data.balance<25000)return toast("–ú–∞–ª–æ –¥–µ–Ω–µ–≥");data.balance-=25000;data.botExp=Date.now()+1800000;save();toast("Bot active!");}
        function buyCosmetic(t,c){if(data.balance<c)return toast("–ú–∞–ª–æ –¥–µ–Ω–µ–≥");if(data.upgrades[t])return toast("–ö—É–ø–ª–µ–Ω–æ");data.balance-=c;data.upgrades[t]=true;save();updateSettings();toast("–ö—É–ø–ª–µ–Ω–æ!");}
        
        // P2P, Chat, Top - Same as before (Included in full block)
        function loadP2P(){const l=document.getElementById('p2p-list');db.collection('market').orderBy('createdAt','desc').limit(20).get().then(s=>{l.innerHTML='';s.forEach(d=>{const dt=d.data();const el=document.createElement('div');el.className='card';el.innerHTML=`<img src="${BASE+dt.nft.u}" class="nft-img"><div class="nft-name">${dt.nft.name}</div><div>${dt.price}</div><button class="btn-sm btn-outline" onclick="buyP2P('${d.id}',${dt.price})">Buy</button>`;l.appendChild(el);});});}
        function buyP2P(id,p){if(data.balance<p)return toast("$$$");db.runTransaction(async t=>{const lot=(await t.get(db.collection('market').doc(id))).data();t.update(db.collection('users').doc(lot.seller),{balance:firebase.firestore.FieldValue.increment(p)});t.update(db.collection('users').doc(myNick),{balance:firebase.firestore.FieldValue.increment(-p),inventory:firebase.firestore.FieldValue.arrayUnion(lot.nft)});t.delete(db.collection('market').doc(id));}).then(()=>{toast("Bought!");loadP2P();});}
        
        // Standard helpers
        function setNftTab(t){['equip','sell','gift'].forEach(x=>document.getElementById('tab-'+x).style.display='none');document.getElementById('tab-'+t).style.display='block';}
        function switchMarket(t,el){['shop','p2p'].forEach(x=>document.getElementById('view-'+x).style.display='none');document.getElementById('view-'+t).style.display='block';document.querySelectorAll('#screen-market .tab').forEach(e=>e.classList.remove('active'));el.classList.add('active');if(t==='p2p')loadP2P();}
        function switchGame(t,el){['mines','coin','slots'].forEach(x=>document.getElementById('game-'+x).style.display='none');document.getElementById('game-'+t).style.display='block';document.querySelectorAll('#screen-casino .tab').forEach(e=>e.classList.remove('active'));el.classList.add('active');}
        function nav(s,el){document.querySelectorAll('.screen').forEach(e=>e.classList.remove('active'));document.getElementById('screen-'+s).classList.add('active');document.querySelectorAll('.nav-item').forEach(e=>e.classList.remove('active'));el.classList.add('active');}
        function openModal(id){document.getElementById(id).style.display='flex';}
        function closeModal(id){document.getElementById(id).style.display='none';}
        function toast(m){const t=document.getElementById('toast');t.innerText=m;t.style.display='block';setTimeout(()=>t.style.display='none',2000);}
        function removeFromEquip(id) { const idx = data.equipped.findIndex(e => e.id === id); if(idx > -1) { data.equipped.splice(idx,1); } }
        function sellSystem(){ const n = data.inventory[selIdx]; removeFromEquip(n.id); const p=Math.floor((n.p||1000)*0.5); data.balance+=p; data.inventory.splice(selIdx,1); save(); closeModal('nft-modal'); toast(`Sold +${p}`); }
        function addFriend(){const n=document.getElementById('search-nick').value.trim();db.collection('users').doc(n).get().then(d=>{if(!d.exists)return toast("err");db.collection('users').doc(myNick).update({friends:firebase.firestore.FieldValue.arrayUnion(n)});toast("ok");});}
        function renderFriends(){const l=document.getElementById('friends-list');l.innerHTML='';data.friends.forEach(f=>{const d=document.createElement('div');d.className='friend-item';d.innerHTML=`<span>${f}</span>`;l.appendChild(d);});}
    </script>
</body>
</html>
